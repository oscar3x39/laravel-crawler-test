FROM php:7.4-fpm

ENV NODE_VERSION 18.3.0

WORKDIR /var/www/html

USER root

RUN apt-get update
RUN apt-get install -y libmcrypt-dev curl
RUN apt-get install -y build-essential

# source not found problem
RUN rm /bin/sh && ln -s /bin/bash /bin/sh

# Install nvm with node and npm
RUN touch ~/.bashrc && chmod +x ~/.bashrc
RUN curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash
RUN . ~/.nvm/nvm.sh && source ~/.bashrc && nvm install ${NODE_VERSION}
# RUN . ~/.nvm/nvm.sh && source ~/.bashrc && which node
# RUN . ~/.nvm/nvm.sh && source ~/.bashrc && npm -v
ENV PATH="~/.nvm/versions/node/v${NODE_VERSION}/bin/:$PATH"
#RUN export PATH="/root/.nvm/versions/node/v${NODE_VERSION}/bin/:$PATH" && cd /var/www/html && npm install puppeteer

#RUN rm -rf /var/lib/apt/lists

RUN pecl install mcrypt-1.0.4
RUN docker-php-ext-install pdo pdo_mysql
RUN docker-php-ext-enable pdo pdo_mysql mcrypt
RUN docker-php-ext-install opcache
RUN pecl install xdebug
RUN docker-php-ext-enable xdebug

RUN chown -R 755 /var/www
RUN rm -rf /var/cache/apk/*

ADD . /var/www/html
# RUN chown -R www-data:www-data /var/www/html
# USER www-data